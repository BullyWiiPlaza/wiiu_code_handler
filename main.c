#include <stdlib.h>
#include "code_handler/code_handler.h"
#include "code_handler/code_handler_enumerations.h"

/*void runRegressionTests() {
	enableRealMemoryAccesses = true;

	char array[100];
	memset(array, 0, sizeof(array));
	unsigned int a = (unsigned int) &array;
	a = getInt((const unsigned char *) &a);
	int value = 0x12345678;
	int increment = 1;
	int stepSize = 8;
	int iterations = 4;
	skipWriteMemory((unsigned char *) &a, (unsigned char *) &value, 4, (unsigned char *) &stepSize,
					(unsigned char *) &increment, (unsigned char *) &iterations);

	enableRealMemoryAccesses = false;
}*/

int main() {
	// runRegressionTests();

/*#define LENGTH 4
	char array[LENGTH] = {0, 0, 0, 0};
	char array2[LENGTH] = {0, 0, 0, 0};
	VirtualMemory memoryWrite = {0x12345678, LENGTH, (unsigned char *) array};
	VirtualMemory memoryWrite2 = {0x12345678, LENGTH, (unsigned char *) array2};
	bool equal = equals(memoryWrite, memoryWrite2);
	log_printf("Equals: %i\n", equal);*/

	unsigned char codes[] = {
			CODE_TYPE_RAM_WRITE,
			0x02, 0x00, 0x00,
			0x10, 0x6E, 0xE1, 0xE4,
			0x00, 0xDC, 0xFF, 0x00,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_FILL_MEMORY_AREA,
			0x00,
			0x00, 0x00,
			0x09, 0x87, 0x65, 0x42,
			0x12, 0x34, 0x56, 0x78,
			0x00, 0x00, 0x00, 0x0C,

			CODE_TYPE_LOAD_INTEGER,
			0x00,
			0x00,
			0x05,
			0x12, 0x34, 0x56, 0x78,

			CODE_TYPE_STORE_INTEGER,
			0x01,
			0x00,
			0x05,
			0x12, 0x34, 0x56, 0x78,

			CODE_TYPE_LOAD_INTEGER,
			0x02,
			0x00,
			0x04,
			0x12, 0x34, 0x56, 0x78,

			CODE_TYPE_INTEGER_OPERATION, 0x00, 0x05, 0x04,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_INTEGER_OPERATION, 0x07, 0x04, 0x00,
			0x00, 0x00, 0x00, 0x03,

			CODE_TYPE_ADD_TIME_DEPENDENCE, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x03,

			CODE_TYPE_RESET_TIMER, 0x00,
			0x00, 0x00,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_TIMER_TERMINATION, 0x00, 0x00, 0x00,
			0xCA, 0xFE, 0xBA, 0xBE,

			CODE_TYPE_LOAD_FLOAT,
			0x00, 0x00,
			0x04,
			0x12, 0x34, 0x56, 0x78,

			CODE_TYPE_FLOAT_OPERATION,
			0x08,
			0x04,
			0x04,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_STORE_FLOAT,
			0x00, 0x00,
			0x04,
			0x12, 0x34, 0x56, 0x78,

			CODE_TYPE_AND,
			0x01,
			0x00, 0x00,
			0x12, 0x13, 0x14, 0x18,
			0x00, 0x00, 0x12, 0x34,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_RAM_WRITE,
			0x11,
			0x00, 0x00,
			0x12, 0x34, 0x56, 0x78,
			0x98, 0x76, 0x54, 0x32,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_TERMINATOR, 0x00, 0x00, 0x00, 0xDE, 0xAD, 0xCA, 0xFE,

			CODE_TYPE_STRING_WRITE, 0x00,
			0x00, 0x09,
			0x10, 0x64, 0x7C, 0xFC,
			0x57, 0x6F, 0x6C, 0x66, 0x67, 0x61, 0x6E, 0x67,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,

			CODE_TYPE_LOAD_POINTER, 0x00, 0x00, 0x00,
			0x12, 0x34, 0x56, 0x78,
			0x10, 0x00, 0x00, 0x00,
			0x20, 0x00, 0x00, 0x00,

			CODE_TYPE_ADD_OFFSET_TO_POINTER,
			0x00, 0x00, 0x00,
			0x10, 0x30, 0x50, 0x70,

			CODE_TYPE_EXECUTE_ASSEMBLY, 0x00, 0x00, 0x02,
			0x60, 0x00, 0x00, 0x00,
			0x3C, 0x60, 0x12, 0x34, 0x60, 0x63, 0x56, 0x78,
			0x3C, 0x80, 0xAA, 0xBB, 0x4E, 0x80, 0x04, 0x20,

			CODE_TYPE_SKIP_WRITE,
			0x02,
			0x00, 0x02,
			0x12, 0x34, 0x56, 0x78,
			0x98, 0x76, 0x54, 0x32,
			0x00, 0x01, 0x00, 0x08,
			0x00, 0x00, 0x00, 0x04,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_NO_OPERATION, 0x00, 0x00, 0x00, 0xDE, 0xAD, 0xC0, 0xDE,

			CODE_TYPE_CORRUPTER, 0x00, 0x00, 0x00,
			0x11, 0x00, 0x00, 0x00,
			0x11, 0x00, 0x00, 0x10,
			0x00, 0x00, 0x00, 0x00,
			0x40, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_PERFORM_SYSTEM_CALL, 0x00,
			0x67, 0x12,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_IF_VALUE_BETWEEN,
			0x02,
			0x00, 0x00,
			0x11, 0x11, 0x11, 0x11,
			0x22, 0x22, 0x22, 0x22,
			0x33, 0x33, 0x33, 0x33,

			CODE_TYPE_IF_NOT_EQUAL,
			0x02,
			0x00, 0x00,
			0x12, 0x34, 0x56, 0x78,
			0x98, 0x76, 0x54, 0x32,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_TERMINATOR, 0x00, 0x00, 0x00, 0xDE, 0xAD, 0xCA, 0xFE,

			CODE_TYPE_IF_EQUAL,
			0x01,
			0x00, 0x00,
			0x12, 0x34, 0x56, 0x78,
			0x98, 0x76, 0x54, 0x32,
			0x00, 0x00, 0x00, 0x00,

			CODE_TYPE_TERMINATOR, 0x00, 0x00, 0x00, 0xDE, 0xAD, 0xCA, 0xFE,

			CODE_TYPE_SEARCH_TEMPLATE,
			0x00, 0x03, 0x08,
			0x10, 0x00, 0x13, 0x00,
			0x3F, 0x80, 0x00, 0x00,
			0x40, 0x00, 0x00, 0x00,

			CODE_TYPE_RAM_WRITE,
			0x12,
			0x00, 0x24,
			0x12, 0x34, 0x56, 0x78,

			CODE_TYPE_TERMINATOR, 0x00, 0x00, 0x00, 0xDE, 0xAD, 0xCA, 0xFE,

			CODE_TYPE_PROCEDURE_CALL,
			0x01, 0x02,
			0x05,
			0x12, 0x34, 0x56, 0x78,
			0x33, 0x33, 0x33, 0x33,
			0x44, 0x44, 0x44, 0x44,
			0x55, 0x55, 0x55, 0x55,
			0x66, 0x66, 0x66, 0x66,
			0x77, 0x77, 0x77, 0x77,
			0x88, 0x88, 0x88, 0x88
	};

	runCodeHandler(codes, sizeof(codes));

	return EXIT_SUCCESS;
}